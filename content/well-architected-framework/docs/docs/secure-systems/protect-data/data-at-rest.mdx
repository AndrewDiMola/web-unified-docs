---
page_title: Protect data at-rest
description: Learn how to protect your sensitive data.
---

# Protect data at rest

Data at rest represents any data you maintain in non-volatile storage in your environment.
Encrypting data at rest, and implementing secure access to your data are two ways you can protect
your applications from security threats.

### Encrypt data with Vault

Vault uses a security barrier for all requests made to its API endpoints.
This security barrier automatically encrypts all data leaving Vault using a 256-bit Advanced Encryption Standard (AES) cipher in the Galois Counter Mode (GCM) with 96-bit nonces.
Vault's barrier encrypts your data, and Vault stores only encrypted data regardless of configured storage type.
Whenever you use a Vault secrets engine, such as the [Key/Value (KV) secrets engine](/vault/docs/secrets/kv), you also gain the benefits of Vault's cryptographic barrier. You (or your application) must authenticate with Vault to receive a token with attached policies that authorize access to data stored in a secrets engine. You shouldn't store large volumes of secrets in Vault. Instead, you should store the secrets in a database, encrypt the database, and store the encryption key in Vault.

For example, when working with a Microsoft SQL Server using Transparent Data Encryption (TDE), your database already encrypts data using a Data Encryption Key (DEK). Rather than moving all that data to Vault, you should store the Key Encryption Key (KEK) in Vault's KV secrets engine. This KEK encrypts the DEK, which in turn encrypts your database content. This approach leverages Vault's strong security features for the most sensitive component (the encryption key) while enabling your database to efficiently manage the encrypted data.

The following diagram shows how you can store an encryption key in Vault, and use that key to encrypt your database.

<ImageConfig hideBorder>

![Encrypt overview](/img/docs/well-architected/vault-ms-sql-1.png)

</ImageConfig>

When you control access to data, you gain another layer of data protection.
Vault can secure access to your external data at rest through dynamic credentials.
These dynamic credentials have a lifecycle attached to them, and Vault automatically revokes them after a predefined period of time.
We recommend using dynamic secrets when accessing your external data.

For example, you can use Vault to issue your CI/CD pipeline dynamic credentials to an external service,
such as a PostgreSQL database. Dynamic secrets allows your CI/CD pipelines to access your data at rest,
and then once the pipeline finishes, Vault revokes the credentials.
The next time your pipeline runs, Vault issues your pipeline new credentials.

HashiCorp resources:
- Learn to use [Vault dynamic secrets](/vault/tutorials/get-started/understand-static-dynamic-secrets)
- Learn to use [versioned key/value secrets engine](/vault/tutorials/secrets-management/versioned-kv)
- Read how to [retrieve CI/CD secrets from Vault](/well-architected-framework/security/security-cicd-vault).
- Read the [Vault's Key/Value (KV) secrets engine](/vault/docs/secrets/kv) documentation


External resources:
- [Advanced Encryption Standard](https://en.wikipedia.org/wiki/Advanced_Encryption_Standard) and [Galois Counter Mode](https://en.wikipedia.org/wiki/Galois/Counter_Mode)
- [Enabling transparent data encryption for Microsoft SQL with Vault](https://www.hashicorp.com/blog/enabling-transparent-data-encryption-for-microsoft-sql-with-vault)
- [Why you should use ephemeral credentials](https://www.liatrio.com/blog/why-you-should-be-using-ephemeral-credentials)


### Enforce encryption with Terraform

You should protect sensitive data by enforcing encryption standards with infrastructure-as-code (IaC).

Terraform can help you secure your data at rest by deploying infrastructure from code that specifies
resource and data encryption, along with access control policies.

As an example of using Terraform to create infrastructure that securely stores data, consider
enabling server-side encryption by default in an AWS S3 bucket.
Terraform can [create a KMS key](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/kms_key)
using the `aws_kms_key` resource. It can then create an S3 bucket,
[enable default server side encryption](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket#enable-default-server-side-encryption)
for the S3 bucket, and then use the KMS key to encrypt objects.

The following example creates a KMS key and enforces S3 object encryption server-side:

```hcl
resource "aws_kms_key" "mykey" {
  description           = "This key is used to encrypt bucket objects"
  deletion_window_in_days = 10
}

resource "aws_s3_bucket" "mybucket" {
  bucket = "mybucket"
}

resource "aws_s3_bucket_server_side_encryption_configuration" "example" {
  bucket = aws_s3_bucket.mybucket.id

  rule {
        apply_server_side_encryption_by_default {
        kms_master_key_id = aws_kms_key.mykey.arn
        sse_algorithm   = "aws:kms"
        }
  }
}
```

The [AWS S3 module](https://github.com/terraform-aws-modules/terraform-aws-s3-bucket/blob/master/examples/complete/main.tf#L28)
provides Terraform code that creates a KMS key and
[encrypts objects](https://github.com/terraform-aws-modules/terraform-aws-s3-bucket/blob/master/examples/complete/main.tf#L189)
stored in the S3 bucket with the KMS key. You can use this module to create and secure your S3 buckets.

You can enforce data at rest encryption with Terraform in other clouds such as GCP, Azure, and on-prem.

HashiCorp resources:

- [Encrypting data with Transform secrets engine](/vault/tutorials/adp/transform-code-example)
- [Transform sensitive data with Vault](/vault/tutorials/adp/transform)
- View our tutorial library on [data encryption](/vault/tutorials/encryption-as-a-service)