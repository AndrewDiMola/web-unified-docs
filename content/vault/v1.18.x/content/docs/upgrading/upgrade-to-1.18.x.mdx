---
layout: docs
page_title: Upgrade to Vault 1.18.x - Guides
description: |-
  Deprecations, important or breaking changes, and remediation recommendations
  for anyone upgrading to 1.18.x from Vault 1.17.x.
---

# Overview

The Vault 1.18.x upgrade guide contains information on deprecations, important
or breaking changes, and remediation recommendations for anyone upgrading from
Vault 1.17. **Please read carefully**.

## Breaking changes

@include '../../../global/partials/important-changes/breaking-changes/cve-2025-6000.mdx'

## Important changes

### JSON Payload Limits

| Change       | Affected version | Vault edition
| ------------ | ---------------- | -------------
| New behavior | 1.18.14           | All
|              |                  |              |
|              |                  |              |

To provide deeper protection against potential Denial-of-Service (DoS) attacks, this release
introduces several new security limits that are applied to incoming JSON request bodies.
These settings are configured on a listener and give administrators granular control over the
structure and size of JSON payloads that Vault will process.
We've chosen defaults that are intentionally generous to accommodate a wide range of
legitimate use cases, but they provide a strong defense against malicious or malformed requests.

`max_json_depth`
This parameter specifies the maximum allowed nesting depth of a JSON object or array.
It serves as a critical defense against "JSON depth bomb" attacks, where a malicious
client sends a deeply nested payload to cause a stack overflow on the server.
The default value is 500, which is well above the nesting level of any typical
Vault configuration or secret, providing a robust safeguard without impacting normal operations.

`max_json_string_value_length`
This parameter defines the maximum allowed length for any single string value
within a JSON payload, measured in bytes. This limit prevents a client from
sending a request with an extremely large string to cause excessive memory allocation on the server.
The default value is 1,048,576 bytes (1MB), which is aligned with Vault's default storage backend
limit and is large enough to comfortably accommodate common secrets like full TLS certificate chains.

`max_json_object_entry_count`
This parameter sets the maximum number of key-value pairs allowed in a single JSON object.
This is a direct defense against HashDoS (Hash Flooding) attacks, where an attacker could send
an object with an enormous number of keys to overwhelm the server's CPU. A legitimate JSON object
with more than 10,000 keys is extremely rare, so the default provides a high ceiling for normal operations
while ensuring server stability.

`max_json_array_element_count`
This parameter determines the maximum number of elements permitted in a single JSON array.
Its primary purpose is to protect the server from having to construct and hold a massive,
memory-intensive array in a single API response, which is most common during LIST operations on secrets paths.
The default of 10,000 elements acts as a sensible guardrail.

### Rekey cancellations use a nonce ((#rekey-cancel-nonce))
| Change       | Affected version | Affected deployments
| ------------ | ---------------- | --------------------
| Breaking     | 1.18.11+ | Any

Vault 1.18.11 and onwards requires a nonce to cancel
[rekey](/vault/api-docs/system/rekey) and
[rekey recovery key](/vault/api-docs/system/rekey-recovery-key) operations
within 10 minutes of initializing a rekey request. Cancellation requests after
the 10 minute window do not require a nonce and succeed as expected.

#### Recommendation
To cancel a rekey operation, provide the nonce value from the
`/sys/rekey/init` or `sys/rekey-recovery-key/init` response.

### Strict validation for Azure auth login requests ((#strict-azure))

| Change       | Affected version
| ------------ | ----------------
| New behavior | 1.18.7

Azure auth plugin requires `resource_group_name`, `vm_name`, and `vmss_name` to
match the JWT claims on login.

Vault versions before 1.18.7 did not strictly validate the
`resource_group_name`, `vm_name`, and `vmss_name` parameters against their token
claims for clients logging in with Azure authentication.

#### Recommendation

Review the [Token validation](/vault/docs/auth/azure#token-validation) section
of the Azure authN plugin guide for more information on the new validation
requirements.

### Activity Log Changes

#### Default Activity Log Querying Period

The field `default_report_months` can no longer be configured or read. Any previously set values
will be ignored by the system.


Attempts to modify `default_report_months` through the
[/sys/internal/counters/config](/vault/api-docs/system/internal-counters#update-the-client-count-configuration)
endpoint, will result in the following warning from Vault:

<CodeBlockConfig hideClipboard>

```shell-session

WARNING! The following warnings were returned from Vault:

  * default_report_months is deprecated: defaulting to billing start time


```

</CodeBlockConfig>


The `current_billing_period` toggle for `/sys/internal/counters/activity` is also deprecated, as this will be set
true by default.

Attempts to set `current_billing_period` will result in the following warning from Vault:

<CodeBlockConfig hideClipboard>

```shell-session

WARNING! The following warnings were returned from Vault:

  * current_billing_period is deprecated; unless otherwise specified, all requests will default to the current billing period


```

</CodeBlockConfig>

#### Counters API requires start time in Vault Community

Vault Community requires the `start_time` parameter  for
`/sys/internal/counters/activity`. Unlike Enterprise Vault, Vault Commuity does
not define a billing start time, and ommitting `start_time` may lead to
unexpected behavior in affected versions (1.18.x and 1.19.x). 

You can safely omit `start_time` for Vault Enterprise as `start_time` defaults
to the billing start date for the cluster. To avoid issues and unexpected
behavior, always provide an explicit start time if you use Vault Community.

### Docker image no longer contains `curl`

The `curl` binary is no longer included in the published Docker container images for Vault and Vault
Enterprise. If your workflow depends on `curl` being available in the container, consider one of the
following strategies:

#### Create a wrapper container image

Use the HashiCorp image as a base image to create a new container image with `curl` installed.

```Dockerfile
FROM hashicorp/vault-enterprise
RUN apk add curl
```

**NOTE:** While this is the preferred option it will require managing your own registry and rebuilding new images.

#### Install it at runtime dynamically

When running the image as root (not recommended), you can install it at runtime dynamically by using the `apk` package manager:

```shell-session
docker exec <CONTAINER-ID> apk add curl
```
```shell-session
kubectl exec -ti <NAME> -- apk add curl
```

When running the image as non-root without privilege escalation (recommended) you can use existing
tools to install a static binary of `curl` into the `vault` users home directory:

```shell-session
docker exec <CONTAINER-ID> wget https://github.com/moparisthebest/static-curl/releases/latest/download/curl-amd64 -O /home/vault/curl && chmod +x /home/vault/curl
```
```shell-session
kubectl exec -ti <NAME> -- wget https://github.com/moparisthebest/static-curl/releases/latest/download/curl-amd64 -O /home/vault/curl && chmod +x /home/vault/curl
```

**NOTE:** When using this option you'll want to verify that the static binary comes from a trusted source.

### Request limiter configuration removal

Vault 1.16.0 included an experimental request limiter. The limiter was disabled
by default with an opt-in `request_limiter` configuration.

Further testing indicated that an alternative approach improves performance and
reduces risk for many workloads. Vault 1.17.0 included a new [adaptive overload
protection](/vault/docs/concepts/adaptive-overload-protection) feature that
prevents outages when Vault is overwhelmed by write requests.

Adaptive overload protection was a beta feature in 1.17.0.

As of Vault 1.18.0, the adaptive overload protection feature for writes is
now GA and enabled by default for the integrated storage backend.

The beta `request_limiter` configuration stanza is officially removed in Vault 1.18.0.

Vault will output two types of warnings if the `request_limiter` stanza is
detected in your Vault config.

1. A UI warning message printed to `stderr`:

```text
WARNING: Request Limiter configuration is no longer supported; overriding server configuration to disable
```

2. A log line with level `WARN`, appearing in Vault's logs:

```text
... [WARN]  unknown or unsupported field request_limiter found in configuration at config.hcl:22:1
```

### Product usage reporting

As of 1.18.2, Vault will collect anonymous product usage metrics for HashiCorp. This information will be collected
alongside client activity data, and will be sent automatically if automated reporting is configured, or added to manual
reports if manual reporting is preferred.

See the main page for [Vault product usage metrics reporting](/vault/docs/enterprise/license/product-usage-reporting) for
more details, and information about opt-out.

### File audit devices require explicit configuration for prefixing and cannot use executable file permissions (CVE-2025-6000)

| Change       | Affected version                          | Fixed version
| ------------ | ----------------------------------------- | --------------------
| Breaking     | 1.18.12                                   | N/A

You must set `allow_audit_log_prefixing` to `true` in your server configuration to enable `file` audit devices with the `prefix` option. Additionally, `file` audit devices cannot use file modes with executable permissions (e.g., 0777, 0755).

#### Recommendation

If you use `file` audit devices, you need to:

1. Add `allow_audit_log_prefixing = true` to your Vault server configuration if
   you want to use the `prefix` option.
1. Use non-executable file modes (e.g., 0644, 0666) for log files.


## Known issues and workarounds

@include 'known-issues/duplicate-hsm-key.mdx'

@include 'known-issues/database-skip-static-role-rotation.mdx'

@include 'known-issues/azure-unseal-regression.mdx'

@include 'known-issues/static-role-premature-rotations.mdx'

@include 'known-issues/database-static-role-premature-rotations.mdx'

@include 'known-issues/log_file_flush_issue.mdx'

@include 'known-issues/azure-auth-fails-uniform-vmss.mdx'

@include 'known-issues/enterprise-plugins.mdx'
