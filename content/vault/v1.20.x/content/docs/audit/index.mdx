---
layout: docs
page_title: Audit Devices
description: Audit devices are mountable devices that log requests and responses in Vault.
---

# Audit logging

With a small set of [exceptions](#excepted-api-endpoints), Vault audit devices enable the detailed recording of all API requests and responses. An audit device can be a [file](/vault/docs/audit/file), a [syslog server](/vault/docs/audit/syslog), or a [socket](/vault/docs/audit/socket).

Refer to the [best practices](/vault/docs/audit/best-practices) page for important considerations before configuring your audit devices.

Audit logs are distinct from server logs (also known as operational logs). Server logs emit information about the Vault server process, such as process errors and configuration warnings. Audit logs record the details of every request received and response and sent by the Vault API. Refer to the [Troubleshoot Vault](/vault/tutorials/monitoring/troubleshooting-vault#vault-server-logs) tutorial for more information about server logs.

## Enabling and disabling audit devices

When you initialize a new Vault cluster, auditing is disabled. You must enable audit devices with the [API](/vault/api-docs/system/audit#enable-audit-device) or related tooling (such as the [Vault CLI](/vault/docs/commands/audit/enable) or the [Terraform Vault provider](/vault/docs/configuration/programmatic-management)).

When you enable an audit device, you can configure it with a set of options. There is a set of [common configuration options](/vault/api-docs/system/audit#common-configuration-options) that apply to all types of audit devices. In addition, each type of audit device has its own set of options, which are documented in the respective page for that audit device type.

For example, the command below enables a `file` type audit device that writes to the file at `/var/log/vault_audit.log`. The additional options disable [hashing](#hashing-of-sensitive-values) of token accessors and [elide list responses](#eliding-list-response-bodies):

```shell-session
$ vault audit enable file \
    file_path=/var/log/vault_audit.log \
    hmac_accessor=false \
    elide_list_responses=true
```

Audit device configurations are replicated to all nodes within a cluster. In Vault Enterprise, audit device configurations are also replicated to Performance Secondary and DR Secondary clusters unless the audit device is configured as [`local`](/vault/api-docs/system/audit#local) to the cluster.

<Note>
  Before enabling an audit device, ensure that all Vault nodes to which the audit device configuration will be replicated can successfully log to that audit device.
</Note>

When an audit device is disabled, it will stop receiving logs immediately. The existing logs that it did store are untouched.

<Warning>
  Once an audit device is disabled, you will no longer be able to <a href="#hashing-of-sensitive-values">compute hashes</a> for audit log entries previously written to that audit device. This is true even if you re-enable the audit device at the same path, as a new hashing key will be created.
</Warning>

## Availability of audit devices  

Audit logs are critically important, and ignoring auditing failures opens an avenue for attack. As such, when you enable at least one audit device, Vault guarantees that every API request and response is recorded to *at least one* of the enabled audit devices. If at least one audit device is enabled *and* Vault cannot write to at least one of the enabled audit devices, Vault refuses to service the corresponding API request.

<Note>
  When all enabled audit devices become unavailable, Vault in effect becomes unavailable as well. To prevent audit-related unavailability of Vault, HashiCorp recommends that at least two audit devices be enabled. Refer to the <a href="/vault/docs/audit/best-practices">best practices</a> page for additional information.
</Note>

When two or more audit devices are enabled, Vault will attempt to send each audit log entry to all audit devices. However, Vault guarantees only that an audit log entry is written to *at least one* audit device. Hence, to ensure a complete record of every API request and response when multiple audit devices are enabled, you must analyze the combined audit log entries across all enabled audit devices.

## Hashing of sensitive values ((#hashing-of-sensitive-values))

To protect the confidentiality of potentially sensitive information in audit logs, Vault by default writes only a keyed hash (HMAC-SHA256) of most string values within request and response audit entries. Vault exposes an API endpoint, [`/sys/audit-hash`](/vault/api-docs/system/audit-hash), to calculate the keyed hash of any known value for a given audit device.

Users can configure which request/response attributes are exempted from hashing for each [authentication backend](/vault/docs/commands/auth/tune) and [secrets engine](/vault/docs/commands/secrets/tune) they configure.

<Note>
  Non-string values, such as integers and booleans, are not hashed. HashiCorp recommends that all sensitive data be provided as string values inside all JSON sent to Vault. For example, integer values should be encapsulated in quotes.
</Note>

## Eliding list response bodies

Some Vault responses can be very large. This is commonly the case with "list" requests, where listing a very large set of objects (such as a list of leases) can result in a response that is tens of megabytes long. Some audit backends are unable to process individual audit records of larger sizes.

In parallel, the contents of the response for a list operation are often of little value. Most responses contain only a "keys" field with a list of IDs. Some API endpoints (e.g. [`/identity/entity-alias/id`](/vault/api-docs/secret/identity/entity-alias#list-entity-aliases-by-id)) additionally return a "key\_info" field with some additional information about each list entry; even in this case, the information returned is usually not sensitive.

The [`elide_list_responses`](/vault/api-docs/system/audit#elide_list_responses) option causes `keys` and `key_info` lists in audit log entries for responses to list requests to be replaced with the number of objects they contain. This improves compatibility with audit devices and reduces the amount of audit data that is ingested, stored, and processed, while retaining some level of information about what was returned to the client.

Here is an example of an audit record with elided lists (formatted with extra whitespace, and with fields not relevant to the example omitted):

```json
{
  "type": "response",
  "request": {
    "operation": "list"
  },
  "response": {
    "data": {
      "key_info": 4,
      "keys": 4 // instead of ["a", "b", "c", "d"]
    }
  }
}
```

## Logging of request headers

You can use the [`/sys/config/auditing`](/vault/api-docs/system/config-auditing#create-update-audit-request-header) API to configure which headers in incoming client requests should be recorded in the corresponding audit log entries.

By default, Vault will automatically record values for the User Agent header, as well as for the `correlation-id` and `x-correlation-id` request headers to assist with request correlation in distributed systems.

<Note>
  Request header values are not hashed by default, including for the <code>correlation-id</code> and <code>x-correlation-id</code> headers. You can <a href="/vault/api-docs/system/config-auditing#hmac">configure</a> Vault to apply the <a href="#hashing-of-sensitive-values">keyed hash</a> to the values of request headers you consider sensitive.
</Note>

## Excepted API endpoints ((#excepted-api-endpoints))

Requests and responses to and from the following API endpoints are **not** recorded to Vault's audit devices:

```
sys/init
sys/seal-status
sys/seal
sys/step-down
sys/unseal
sys/leader
sys/health
sys/rekey/init
sys/rekey/update
sys/rekey/verify
sys/rekey-recovery-key/init
sys/rekey-recovery-key/update
sys/rekey-recovery-key/verify
sys/storage/raft/bootstrap
sys/storage/raft/join
sys/internal/ui/feature-flags
```

Additionally, requests to the following API endpoints are not recorded if unauthenticated access to them is permitted by the relevant listener configuration settings:

```
sys/metrics
sys/pprof/*
sys/in-flight-req
```

## Tutorial

Refer to [Recover blocked audit devices](/vault/tutorials/monitoring/blocked-audit-devices) for a step-by-step tutorial.

## API

Vault enables configuration of audit devices via an HTTP API. Please see the [audit API docs](/vault/api-docs/system/audit) for more details.
